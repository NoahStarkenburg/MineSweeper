@model MineSweeper.Models.GameViewModel

<div id="timestamp" style="font-weight: bold; margin-bottom: 10px;">
    Elapsed Time: 0 seconds
</div>

<div id="game-board-container" class="container">
    @Html.Partial("_GameBoard", Model)
</div>

@section Scripts {
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <!-- Timer stays outside the container -->
    <script>
        function updateElapsedTime() {
            $.ajax({
                url: '/Game/GetElapsedTime',
                type: 'GET',
                success: function (data) {
                    $('#timestamp').text(`Elapsed Time: ${data} seconds`);
                }
            });
        }
        setInterval(updateElapsedTime, 1000);
    </script>

    <!-- Intercept left-click form submission (for revealing cells) -->
    <script>
        $(document).on("submit", ".play-move-form", function (e) {
            e.preventDefault();
            var form = $(this);
            $.post(form.attr("action"), form.serialize(), function (data) {
                if (data.gameWon) {
                    window.location.href = data.redirectUrl;
                } else if (data.gameLost) {
                    window.location.href = data.redirectUrl;
                } else {
                    // Update the entire board container with the returned partial view
                    $("#game-board-container").html(data);
                }
            });
        });
    </script>

    <!-- Right-click handler (for flagging a cell) can still update just that cell -->
    <script>
        $(document).on("contextmenu", ".cell", function (event) {
            event.preventDefault();
            var row = $(this).data("row");
            var col = $(this).data("col");
            $.post("/Game/FlagCell", { Row: row, Col: col })
                .done(function (data) {
                    if (data.gameWon) {
                        window.location.href = data.redirectUrl;
                    } else {
                        // For flagging, you may choose to update only the cell
                        $("#cell-" + row + "-" + col).replaceWith(data);
                    }
                })
                .fail(function () {
                    alert("Error processing request.");
                });
            return false;
        });
    </script>
}
